---
import "@repo/ui/sakupi01.com.css";
import Head from "../components/common/Head.astro";

interface Props {
  pageTitle: string;
  description: string;
  url: string;
}

const {
  pageTitle = "Blog",
  description = "The personal website of saku. A Front-end developer, Design Technologist, and an enthusiast of all things about Web & UI",
} = Astro.props;
---

<!doctype html>
<html lang="ja">
  <head>
    <Head title={pageTitle} description={description} type="article" />
    <script>
      (function () {
        const themeToggle = document.getElementById("themeToggle");

        // Function to set theme in localStorage and update DOM
        const setTheme = (theme: "light" | "dark") => {
          localStorage.setItem("theme", theme);
          document.documentElement.classList.toggle("dark", theme === "dark");
          themeToggle?.classList.toggle(
            "theme-toggle--toggled",
            theme === "light"
          );
        };

        // Initialize theme from localStorage or system preference
        const initializeTheme = () => {
          const savedTheme = localStorage.getItem("theme") as
            | "light"
            | "dark"
            | null;
          if (savedTheme) {
            setTheme(savedTheme);
          } else {
            const prefersDark = window.matchMedia(
              "(prefers-color-scheme: dark)"
            ).matches;
            setTheme(prefersDark ? "dark" : "light");
          }
        };

        // Initialize theme on page load
        initializeTheme();

        // Create audio elements for theme toggle sounds
        const lightToAudio = new Audio("/sounds/light-dark-toggle.mp3");
        const darkToAudio = new Audio("/sounds/light-dark-toggle.mp3");

        // Set default properties for audio elements
        [lightToAudio, darkToAudio].forEach((audio) => {
          audio.volume = 0.4;
          audio.preload = "auto";
        });

        // Toggle theme when button is clicked
        themeToggle?.addEventListener("click", () => {
          const currentTheme = document.documentElement.classList.contains(
            "dark"
          )
            ? "dark"
            : "light";
          const newTheme = currentTheme === "dark" ? "light" : "dark";

          const soundEnabled = localStorage.getItem("soundEnabled") !== "false";

          if (soundEnabled) {
            const audio = newTheme === "light" ? lightToAudio : darkToAudio;
            audio
              .play()
              .catch((e) => console.warn("Audio playback failed:", e));
          }

          setTheme(newTheme);
        });

        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", (e) => {
            if (!localStorage.getItem("theme")) {
              setTheme(e.matches ? "dark" : "light");
            }
          });
      })();
    </script>
    <meta name="generator" content={Astro.generator} />
  </head>
  <body class="page">
    <slot />
  </body>
</html>
